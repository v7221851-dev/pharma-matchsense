import pandas as pd
import os
import io # –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥—É–ª—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º –≤ –ø–∞–º—è—Ç–∏

# --- –ù–ê–°–¢–†–û–ô–ö–ò –§–ê–ô–õ–û–í ---
INPUT_FILENAME = 'register_temp.txt'  # –§–∞–π–ª, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –∏–∑ Excel –∫–∞–∫ '–¢–µ–∫—Å—Ç Unicode'
OUTPUT_FILENAME = 'register_ls.csv'   # –§–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞

# --- –ì–õ–ê–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –ö–û–ù–í–ï–†–¢–ê–¶–ò–ò ---

try:
    print(f"üîç –ù–∞—á–∏–Ω–∞–µ—Ç—Å—è —á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ '{INPUT_FILENAME}' —Å –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ–º –æ—à–∏–±–æ–∫ –∫–æ–¥–∏—Ä–æ–≤–∫–∏...")
    
    # 1. –ß–∏—Ç–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞ –∫–∞–∫ —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É—è —Ä–µ–∂–∏–º 'ignore' –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞ –Ω–µ–≤–µ—Ä–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤.
    # –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –±–∞–π—Ç—ã –≤ –ø–æ–∑–∏—Ü–∏–∏ 434-435.
    with open(INPUT_FILENAME, 'r', encoding='utf-16-le', errors='ignore') as f:
        file_content = f.read()

    # 2. –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –æ—á–∏—â–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –≤ StringIO, —á—Ç–æ–±—ã pandas –º–æ–≥ –ø—Ä–æ—á–∏—Ç–∞—Ç—å –µ–≥–æ –∫–∞–∫ —Ñ–∞–π–ª.
    data_io = io.StringIO(file_content)
    
    # 3. –ó–∞–≥—Ä—É–∑–∫–∞ –≤ DataFrame. –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å - —Ç–∞–±—É–ª—è—Ü–∏—è ('\t'), —Ç–∞–∫ –∫–∞–∫ —ç—Ç–æ '–¢–µ–∫—Å—Ç Unicode'.
    # –ü–æ—Å–∫–æ–ª—å–∫—É –∑–∞–≥–æ–ª–æ–≤–æ–∫ —É–∂–µ –±—ã–ª –ø—Ä–æ—á–∏—Ç–∞–Ω, header=None.
    df = pd.read_csv(data_io, sep='\t', header=None)
    
    # 4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–∞. –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–º ';' –∏ –∫–æ–¥–∏—Ä–æ–≤–∫–æ–π UTF-8
    df.to_csv(OUTPUT_FILENAME, sep=';', index=False, header=False, encoding='utf-8-sig')
    
    print(f"‚úÖ –§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω: {OUTPUT_FILENAME}")
    print("–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Å–∫—Ä–∏–ø—Ç 'matching_script.py'!")

except FileNotFoundError:
    print(f"‚ùå –û—à–∏–±–∫–∞: –§–∞–π–ª '{INPUT_FILENAME}' –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ–Ω –≤ –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞.")
except Exception as e:
    print(f"‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –≤–æ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞: {e}")